#!/bin/bash
# Quick viewer for PII scan results

# Default to pii_results directory (matches actual output)
OUTPUT_DIR="${1:-pii_results}"

if [ ! -d "$OUTPUT_DIR" ]; then
    echo "📊 No scan results found yet"
    echo ""
    echo "To get started:"
    echo "1. Run: ./scan demo_files/"
    echo "2. Then run: ./view"
    echo ""
    echo "Or try the interactive scanner:"
    echo "   ./scan"
    exit 0
fi

echo "🔍 PII SCAN RESULTS VIEWER"
echo "=================================================="

# Check if scan is running
if [ -f "$OUTPUT_DIR/.scan_pid" ]; then
    PID=$(cat "$OUTPUT_DIR/.scan_pid")
    if ps -p $PID > /dev/null 2>&1; then
        echo "🟢 SCAN IN PROGRESS (PID: $PID) - Results updating in real-time!"
    fi
fi

echo ""
echo "Choose what to view:"
echo "1. Quick summary (counts only)"
echo "2. Detailed PII (actual values found)"
echo "3. Export to CSV"
echo ""
read -p "👉 Enter choice (1-3): " choice

case $choice in
    1)
        venv/bin/python -m app.status_cli --out "$OUTPUT_DIR"
        ;;
    2)
        venv/bin/python -m app.results_explorer --out "$OUTPUT_DIR"
        ;;
    3)
        venv/bin/python -m app.results_explorer --out "$OUTPUT_DIR" <<< "1"
        echo "✅ Exported to $OUTPUT_DIR/"
        ;;
    *)
        echo "Invalid choice"
        ;;
esac